<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PyScript Full Debug Toolkit</title>
  <link rel="stylesheet" href="https://pyscript.net/releases/2024.11.1/core.css" />
  <script type="module" src="https://pyscript.net/releases/2024.11.1/core.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    h2 { margin-top: 30px; }
    code { background: #eee; padding: 2px 4px; border-radius: 4px; }
    .success { color: green; }
    .error { color: red; }
    .box { padding: 10px; margin: 10px 0; border-left: 4px solid #ccc; background: #f9f9f9; }
  </style>
</head>
<body>

  <h1>üß™ PyScript Full Debugging Toolkit</h1>

  <h2>‚úÖ PyScript Version</h2>
  <div id="version-output" class="box"></div>

  <h2>‚úÖ print() Output</h2>
  <div id="print-output" class="box"></div>

  <h2>‚úÖ display() Output</h2>
  <div id="display-output" class="box"></div>

  <h2>‚úÖ JS ‚Üí Python Communication</h2>
  <button onclick="sendToPython()">Send Message to Python</button>
  <div id="js-to-py-output" class="box"></div>

  <h2>‚úÖ Python ‚Üí JS Console Logs</h2>
  <p>Check your browser's console (DevTools > Console tab)</p>

  <h2>‚úÖ Runtime Python Execution</h2>
  <button onclick="injectPython()">Run dynamic Python</button>
  <div id="dynamic-output" class="box"></div>

  <hr>

  <py-script output="print-output">
try:
    from js import console, document

    import sys
    print("‚úÖ print() is working")
    console.log("‚úÖ Python console log")

    from pyscript import display
    display("‚úÖ display() is working", target="display-output")

    # Python version display
    version = f"Python version: {sys.version}"
    document.getElementById("version-output").innerText = version

    # Define a callback to receive JS messages
    def receive_from_js(msg):
        display(f"‚úÖ Received from JS: {msg}", target="js-to-py-output")

    # Expose to JS
    from pyodide.ffi import create_proxy
    js.receive_from_js = create_proxy(receive_from_js)

except Exception as e:
    print("‚ùå Exception caught:", e)
    console.error("‚ùå Python error:", e)
  </py-script>

  <script>
    function sendToPython() {
      if (window.receive_from_js) {
        window.receive_from_js("Hello from JavaScript!")
      } else {
        document.getElementById("js-to-py-output").innerText = "‚ùå receive_from_js is not defined yet"
      }
    }

    function injectPython() {
      const pyCode = `
try:
    from pyscript import display
    display("‚úÖ This code was injected at runtime!", target="dynamic-output")
except Exception as e:
    from js import console
    console.error("‚ùå Injected code error:", e)
      `;
      pyscript.runPythonAsync(pyCode);
    }

    window.addEventListener("load", () => {
      console.log("‚úÖ HTML page loaded");
    });
  </script>

  <noscript>
    <p class="error">‚ùå JavaScript is disabled. PyScript cannot run.</p>
  </noscript>
</body>
</html>
