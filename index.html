<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PyScript Dynamic Fixes ‚Äì Final Working</title>
  <link rel="stylesheet" href="https://pyscript.net/releases/2024.11.1/core.css" />
  <script type="module" src="https://pyscript.net/releases/2024.11.1/core.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
    h2 { margin-top: 30px; }
    .box { padding: 10px; margin: 10px 0; border-left: 4px solid #ccc; background: #f9f9f9; }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>

  <h1>üß™ PyScript Dynamic Execution ‚Äì Final Fixes</h1>

  <h2>‚úÖ Python Version</h2>
  <div id="version-output" class="box"></div>

  <h2>‚úÖ Static print() Output</h2>
  <div id="print-output" class="box"></div>

  <h2>‚úÖ display() Output</h2>
  <div id="display-output" class="box"></div>

  <h2>‚úÖ Dynamic Execution Tests</h2>

  <button onclick="runDynamic1()">Method 1: run() + print()</button>
  <div id="dynamic-output-1" class="box"></div>

  <button onclick="runDynamic2()">Method 2: set variable + run()</button>
  <div id="dynamic-output-2" class="box"></div>

  <button onclick="runDynamic3()">Method 3: Inject <py-script></button>
  <div id="dynamic-output-3" class="box"></div>

  <py-script id="runner-1" output="dynamic-output-1"></py-script>
  <py-script id="runner-2" output="dynamic-output-2"></py-script>

  <hr>

  <py-script output="print-output">
try:
    import js
    from js import console, document
    import sys
    from pyscript import display
    from pyodide.ffi import create_proxy

    print("‚úÖ Static print() works.")
    console.log("‚úÖ Python to JS logging works")
    display("‚úÖ Static display() works.", target="display-output")
    document.getElementById("version-output").innerText = f"Python {sys.version}"

    def receive_from_js(msg):
        display(f"‚úÖ From JS: {msg}", target="display-output")
    js.receive_from_js = create_proxy(receive_from_js)

except Exception as e:
    print("‚ùå PyScript init error:", e)
    console.error("‚ùå PyScript error:", e)
  </py-script>

  <script>
    async function runDynamic1() {
      const code = `print("‚úÖ Method 1: run() + print() works!")`
      try {
        await pyscript.interpreter.run(code, {
          globals: pyscript.interpreter.globals,
          output: "dynamic-output-1"
        });
      } catch (err) {
        document.getElementById("dynamic-output-1").innerText = "‚ùå Method 1 Failed.";
        console.error("Method 1 Error:", err);
      }
    }

    async function runDynamic2() {
      try {
        pyscript.interpreter.globals.set("msg", "‚úÖ Method 2: set variable + print(msg)")
        const code = `print(msg)`
        await pyscript.interpreter.run(code, {
          output: "dynamic-output-2"
        });
      } catch (err) {
        document.getElementById("dynamic-output-2").innerText = "‚ùå Method 2 Failed.";
        console.error("Method 2 Error:", err);
      }
    }

    function runDynamic3() {
      try {
        const code = `print("‚úÖ Method 3: Injected py-script worked.")`
        const py = document.createElement("py-script")
        py.setAttribute("output", "dynamic-output-3")
        py.textContent = code  // Use textContent, not innerHTML, to avoid HTML tag injection
        document.body.appendChild(py)
      } catch (err) {
        document.getElementById("dynamic-output-3").innerText = "‚ùå Method 3 Failed.";
        console.error("Method 3 Error:", err);
      }
    }
  </script>

  <noscript>
    <p class="error">‚ùå JavaScript is disabled. PyScript won't run.</p>
  </noscript>

</body>
</html>
