<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PyScript Full Debug & Execution Toolkit</title>

  <!-- Full PyScript bundle (most reliable) -->
  <link rel="stylesheet" href="https://pyscript.net/releases/2025.7.3/pyscript.css" />
  <script defer src="https://pyscript.net/releases/2025.7.3/pyscript.js"></script>

  <style>
    body { font-family: sans-serif; padding: 20px; line-height: 1.5; }
    h1, h2 { margin-bottom: 0.5em; }
    .box { 
      padding: 0.5em; 
      margin: 0.5em 0; 
      border-left: 4px solid #888; 
      background: #f7f7f7;
      white-space: pre-wrap;
    }
    button { margin: 0.25em 0.5em 0.75em 0; }
    .error { color: red; }
    .success { color: green; }
  </style>
</head>
<body>

  <h1>üß™ PyScript Full Debug & Execution Toolkit</h1>

  <!-- 1. STATIC INITIALIZATION -->
  <h2>1. Static Initialization Tests</h2>
  <py-script output="init-output">
try:
    import sys
    from js import console, document
    from pyscript import display

    # Static print()
    print("‚úÖ [static] print() works!")

    # Static display()
    display("‚úÖ [static] display() works!", target="init-output")

    # Static console.log()
    console.log("[static] console.log from Python")

    # Python version
    document.getElementById("version-output").innerText = f"Python version: {sys.version}"

except Exception as e:
    # Show any init errors in-page and console
    display(f"‚ùå [static] Exception: {e}", target="init-output")
    console.error("[static] Exception:", e)
  </py-script>

  <div id="version-output" class="box"></div>
  <div id="init-output"      class="box"></div>

  <hr>

  <!-- 2. JS ‚Üî PYTHON INTEROP -->
  <h2>2. JS ‚Üî Python Interop Tests</h2>

  <h3>a) JS ‚Üí Python callback</h3>
  <button onclick="jsToPy()">Send from JS to Python</button>
  <div id="js2py-output" class="box"></div>

  <h3>b) Python ‚Üí JS console</h3>
  <p>Check your Developer Console for a Python‚ÜíJS log: <code>[interop]</code></p>

  <!-- Expose the callback and log test -->
  <py-script>
from js import console
from pyodide.ffi import create_proxy
from pyscript import display

# Python‚ÜíJS console test
console.log("[interop] console.log from Python in interop block")

# Define and expose JS‚ÜíPython callback
def receive_from_js(msg):
    display(f"‚úÖ [interop] JS‚ÜíPython received: {msg}", target="js2py-output")

js.receive_from_js = create_proxy(receive_from_js)
  </py-script>

  <!-- 3. DYNAMIC EXECUTION METHODS -->
  <h2>3. Dynamic Execution Methods</h2>

  <button onclick="method1()">Method 1: Call Python callback</button>
  <div id="dynamic1" class="box"></div>

  <button onclick="method2()">Method 2: interpreter.run()</button>
  <div id="dynamic2" class="box"></div>
  <!-- runner for interpreter.run() -->
  <py-script id="runner2" output="dynamic2"></py-script>

  <button onclick="method3()">Method 3: Inject &lt;py-script&gt;</button>
  <div id="dynamic3" class="box"></div>

  <script>
    // Method 1: invoke the Python callback defined above
    function jsToPy() {
      if (window.receive_from_js) {
        window.receive_from_js("Hello from JS ‚Üí Python!");
      } else {
        document.getElementById("js2py-output").innerText = "‚ùå Callback not ready";
      }
    }

    function method1() {
      // same callback for Method 1
      jsToPy();
    }

    // Method 2: use pyscript.interpreter.run()
    async function method2() {
      const code = `print("‚úÖ [Method 2] interpreter.run() worked!")`;
      try {
        await pyscript.interpreter.run(code, {
          globals: pyscript.interpreter.globals,
          output: "dynamic2"
        });
      } catch (e) {
        document.getElementById("dynamic2").innerText = "‚ùå [Method 2] Exception: " + e;
        console.error("[Method 2] Exception:", e);
      }
    }

    // Method 3: inject a new <py-script> tag dynamically
    function method3() {
      try {
        const tag = document.createElement("py-script");
        tag.setAttribute("output", "dynamic3");
        tag.textContent = `print("‚úÖ [Method 3] injected tag executed!")`;
        document.body.appendChild(tag);
      } catch (e) {
        document.getElementById("dynamic3").innerText = "‚ùå [Method 3] Exception: " + e;
        console.error("[Method 3] Exception:", e);
      }
    }
  </script>

  <noscript>
    <p class="error">‚ùå JavaScript is disabled ‚Äî PyScript cannot run.</p>
  </noscript>

</body>
</html>
